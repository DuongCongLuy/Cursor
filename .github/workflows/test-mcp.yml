name: Test MCP Configuration

on:
  workflow_dispatch:  # Cho phÃ©p cháº¡y thá»§ cÃ´ng
  push:
    branches:
      - main
    paths:
      - '.mcp.json.example'
      - '.github/workflows/test-mcp.yml'

jobs:
  test-mcp:
    runs-on: ubuntu-latest
    
    steps:
      - name: Checkout repository
        uses: actions/checkout@v4
      
      - name: Setup Node.js
        uses: actions/setup-node@v4
        with:
          node-version: '20'
      
      - name: Validate MCP Configuration
        run: |
          echo "ğŸ” Kiá»ƒm tra cáº¥u hÃ¬nh MCP..."
          
          # Kiá»ƒm tra file .mcp.json.example cÃ³ tá»“n táº¡i
          if [ ! -f ".mcp.json.example" ]; then
            echo "âŒ Lá»–I: KhÃ´ng tÃ¬m tháº¥y file .mcp.json.example"
            exit 1
          fi
          
          # Kiá»ƒm tra format JSON
          if ! node -e "JSON.parse(require('fs').readFileSync('.mcp.json.example', 'utf8'))" 2>/dev/null; then
            echo "âŒ Lá»–I: File .mcp.json.example khÃ´ng pháº£i JSON há»£p lá»‡"
            exit 1
          fi
          
          echo "âœ… File .mcp.json.example há»£p lá»‡"
      
      - name: Check GitHub Secrets
        run: |
          echo "ğŸ” Kiá»ƒm tra GitHub Secrets..."
          
          if [ -z "${{ secrets.NOTION_TOKEN }}" ]; then
            echo "âš ï¸  Cáº¢NH BÃO: NOTION_TOKEN chÆ°a Ä‘Æ°á»£c cáº¥u hÃ¬nh trong GitHub Secrets"
          else
            echo "âœ… NOTION_TOKEN Ä‘Ã£ Ä‘Æ°á»£c cáº¥u hÃ¬nh"
          fi
          
          if [ -z "${{ secrets.OPENAI_API_KEY }}" ]; then
            echo "âš ï¸  Cáº¢NH BÃO: OPENAI_API_KEY chÆ°a Ä‘Æ°á»£c cáº¥u hÃ¬nh trong GitHub Secrets"
          else
            echo "âœ… OPENAI_API_KEY Ä‘Ã£ Ä‘Æ°á»£c cáº¥u hÃ¬nh"
          fi
      
      - name: Test Notion MCP (náº¿u cÃ³ token)
        if: ${{ secrets.NOTION_TOKEN != '' }}
        run: |
          echo "ğŸ§ª Test Notion MCP..."
          # LÆ°u Ã½: MCP servers thÆ°á»ng cháº¡y local, khÃ´ng thá»ƒ test Ä‘áº§y Ä‘á»§ trong GitHub Actions
          # ÄÃ¢y chá»‰ lÃ  kiá»ƒm tra cáº¥u hÃ¬nh cÆ¡ báº£n
          echo "âœ… Notion MCP configuration há»£p lá»‡"
      
      - name: Test Claude Context MCP (náº¿u cÃ³ key)
        if: ${{ secrets.OPENAI_API_KEY != '' }}
        run: |
          echo "ğŸ§ª Test Claude Context MCP..."
          # LÆ°u Ã½: MCP servers thÆ°á»ng cháº¡y local, khÃ´ng thá»ƒ test Ä‘áº§y Ä‘á»§ trong GitHub Actions
          # ÄÃ¢y chá»‰ lÃ  kiá»ƒm tra cáº¥u hÃ¬nh cÆ¡ báº£n
          echo "âœ… Claude Context MCP configuration há»£p lá»‡"
      
      - name: Summary
        run: |
          echo ""
          echo "========================================"
          echo "  Káº¾T QUáº¢ KIá»‚M TRA" 
          echo "========================================"
          echo ""
          echo "ğŸ“‹ File .mcp.json.example: âœ… Há»£p lá»‡"
          echo "ğŸ” GitHub Secrets: ÄÃ£ kiá»ƒm tra"
          echo ""
          echo "âš ï¸  LÆ¯U Ã: MCP servers cháº¡y local trong Cursor"
          echo "   GitHub Actions chá»‰ kiá»ƒm tra cáº¥u hÃ¬nh, khÃ´ng test chá»©c nÄƒng"
          echo ""

